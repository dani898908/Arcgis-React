{"version":3,"sources":["../node_modules/@arcgis/core/layers/graphics/sources/FeatureLayerSource.js"],"names":["F","Set","b","p","constructor","super","arguments","this","type","load","e","t","s","signal","addResolvingPromise","_fetchService","l","capabilities","query","supportsFormatPBF","parsedUrl","r","dynamicDataSource","gdbVersion","a","spatialReference","o","layer","u","f","url","path","format","sourceSpatialReference","addAttachment","then","attributes","objectIdField","_getLayerRequestOptions","_getFormDataForAttachment","h","body","_createFeatureEditResult","data","addAttachmentResult","catch","_createAttachmentErrorResult","updateAttachment","attachmentId","updateAttachmentResult","addFeatures","map","_serializeFeature","updateFeatures","_getFeatureIds","deleteFeatures","y","n","deleteAttachments","addAttachments","push","_serializeAttachment","updateAttachments","i","length","adds","updates","deletes","method","JSON","stringify","join","rollbackOnFailure","rollbackOnFailureEnabled","useGlobalIds","globalIdUsed","attachments","d","_createEditsResult","attachmentIds","deleteAttachmentResults","queryAttachments","get","objectIds","parentObjectId","attachmentInfos","m","queryTask","executeAttachmentQuery","queryFeatures","execute","customParameters","queryFeaturesJSON","executeJSON","queryObjectIds","executeForIds","queryFeatureCount","executeForCount","queryExtent","executeForExtent","queryRelatedFeatures","executeRelationshipQuery","queryRelatedFeaturesCount","executeRelationshipQueryForCount","sourceJSON","returnAdvancedSymbols","has","geometry","toJSON","feature","attachment","globalId","name","contentType","uploadId","parentGlobalId","globalIdField","async","c","FileReader","readAsDataURL","onload","result","onerror","mediaType","File","_getIdsFromFeatureIdentifier","_getIdsFromFeatures","objectId","addFeatureResults","addResults","updateFeatureResults","updateResults","deleteFeatureResults","deleteResults","addAttachmentResults","updateAttachmentResults","success","error","code","description","details","messages","message","httpStatus","messageCode","FormData","elements","set","append","source","responseType","prototype","constructOnly","readOnly","dependsOn","g"],"mappings":"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","file":"static/js/149.fbea62ac.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/has.js\";import{fixJson as r}from\"../../../core/lang.js\";import{isSome as s,isNone as a}from\"../../../core/maybe.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as u}from\"../../../core/accessorSupport/decorators/subclass.js\";import n from\"../../../core/Error.js\";import{dataComponents as i}from\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{resolve as l,all as d,create as c}from\"../../../core/promiseUtils.js\";import h from\"../../../request.js\";import p from\"../../../core/Loadable.js\";import{unapplyEditsZUnitScaling as y}from\"../../../tasks/operations/zscale.js\";import{processAttachmentQueryResult as m}from\"../../../tasks/operations/queryAttachments.js\";import f from\"../../../tasks/QueryTask.js\";const F=new Set([\"Feature Layer\",\"Table\"]);let b=class extends p{constructor(){super(...arguments),this.type=\"feature-layer\"}load(e){const t=s(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(t)),l(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:r,dynamicDataSource:s,gdbVersion:a,spatialReference:o}=this.layer,u=t(\"featurelayer-pbf\")&&e?\"pbf\":\"json\";return new f({url:r.path,format:u,dynamicDataSource:s,gdbVersion:a,sourceSpatialReference:o})}addAttachment(e,t){return this.load().then((()=>{const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+\"/\"+r+\"/addAttachment\",a=this._getLayerRequestOptions(),o=this._getFormDataForAttachment(t,a.query);return h(s,{body:o}).then((e=>this._createFeatureEditResult(e.data.addAttachmentResult))).catch((e=>{throw this._createAttachmentErrorResult(r,e)}))}))}updateAttachment(e,t,r){return this.load().then((()=>{const s=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+s+\"/updateAttachment\",o=this._getLayerRequestOptions({query:{attachmentId:t}}),u=this._getFormDataForAttachment(r,o.query);return h(a,{body:u}).then((e=>this._createFeatureEditResult(e.data.updateAttachmentResult))).catch((e=>{throw this._createAttachmentErrorResult(s,e)}))}))}async applyEdits(e,t){await this.load();const r=e.addFeatures.map(this._serializeFeature,this),s=e.updateFeatures.map(this._serializeFeature,this),a=this._getFeatureIds(e.deleteFeatures);y(r,s,this.layer.spatialReference);const o=[],u=[],n=[...e.deleteAttachments];for(const t of e.addAttachments)o.push(await this._serializeAttachment(t));for(const t of e.updateAttachments)u.push(await this._serializeAttachment(t));const i=o.length||u.length||n.length?{adds:o,updates:u,deletes:n}:null,l=this._getLayerRequestOptions({method:\"post\",query:{adds:r.length?JSON.stringify(r):null,updates:s.length?JSON.stringify(s):null,deletes:a.length?a.join(\",\"):null,gdbVersion:null==t?void 0:t.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,attachments:i&&JSON.stringify(i)}}),d=await h(this.layer.parsedUrl.path+\"/applyEdits\",l);return this._createEditsResult(d)}deleteAttachments(e,t){return this.load().then((()=>{const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+\"/\"+r+\"/deleteAttachments\";return h(s,this._getLayerRequestOptions({query:{attachmentIds:t.join(\",\")},method:\"post\"})).then((e=>e.data.deleteAttachmentResults.map(this._createFeatureEditResult))).catch((e=>{throw this._createAttachmentErrorResult(r,e)}))}))}queryAttachments(e,t={}){const{parsedUrl:r}=this.layer,s=r.path;return this.load().then((()=>{const r=this._getLayerRequestOptions(t);if(!this.layer.get(\"capabilities.operations.supportsQueryAttachments\")){const{objectIds:t}=e,a=[];for(const e of t){const t=s+\"/\"+e+\"/attachments\";a.push(h(t,r))}return d(a).then((e=>t.map(((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))))).then((e=>m(e,s)))}return this.queryTask.executeAttachmentQuery(e,r)}))}queryFeatures(e,t){return this.load().then((()=>this.queryTask.execute(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})))}queryFeaturesJSON(e,t){return this.load().then((()=>this.queryTask.executeJSON(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})))}queryObjectIds(e,t){return this.load().then((()=>this.queryTask.executeForIds(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})))}queryFeatureCount(e,t){return this.load().then((()=>this.queryTask.executeForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})))}queryExtent(e,t){return this.load().then((()=>this.queryTask.executeForExtent(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})))}queryRelatedFeatures(e,t){return this.load().then((()=>this.queryTask.executeRelationshipQuery(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})))}queryRelatedFeaturesCount(e,t){return this.load().then((()=>this.queryTask.executeRelationshipQueryForCount(e,{...t,query:{...this.layer.customParameters,...null==t?void 0:t.query}})))}async _fetchService(e){const r=this.layer.sourceJSON;if(r)this.sourceJSON=r;else{const{data:r}=await h(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:t(\"featurelayer-advanced-symbols\")?{returnAdvancedSymbols:!0}:{},signal:e}));this.sourceJSON=r}const s=this.sourceJSON.type;if(!F.has(s))throw new n(\"feature-layer-source:unsupported-type\",`Source type \"${s}\" is not supported`)}_serializeFeature(e){const{geometry:t,attributes:r}=e;return a(t)?{attributes:r}:\"mesh\"===t.type||\"extent\"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:s,name:a,contentType:o,data:u,uploadId:n}=r,l={globalId:s,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(l.parentGlobalId=\"attributes\"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),n)l.uploadId=n;else if(u){const e=await async function(e){if(\"string\"==typeof e){return i(e)||{data:e}}return c(((t,r)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>t(i(s.result)),s.onerror=e=>r(e)}))}(u);l.contentType=e.mediaType,l.data=e.data,u instanceof File&&(l.name=u.name)}return a&&(l.name=a),o&&(l.contentType=o),l}_getFeatureIds(e){const t=e[0];return t?\"objectId\"in t?this._getIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map((e=>e.attributes&&e.attributes[t]))}_getIdsFromFeatureIdentifier(e){return e.map((e=>e.objectId))}_createEditsResult(e){const t=e.data,r=e.data&&e.data.attachments;return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:r&&r.addResults?r.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:r&&r.updateResults?r.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:r&&r.deleteResults?r.deleteResults.map(this._createFeatureEditResult,this):[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new n(\"feature-layer-source:edit-failure\",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,s=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new n(\"feature-layer-source:attachment-failure\",r,{code:s})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const e in t){const s=t[e];null!=s&&(r.set?r.set(e,s):r.append(e,s))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:s,dynamicDataSource:a}=this.layer;return{...e,query:r({gdbVersion:s,layer:a?JSON.stringify({source:a}):void 0,...t.query,f:\"json\",...this.layer.customParameters,...null==e?void 0:e.query}),responseType:\"json\"}}};e([o()],b.prototype,\"type\",void 0),e([o({constructOnly:!0})],b.prototype,\"layer\",void 0),e([o({readOnly:!0,dependsOn:[\"layer.parsedUrl\",\"layer.gdbVersion\",\"layer.dynamicDataSource\"]})],b.prototype,\"queryTask\",null),b=e([u(\"esri.layers.graphics.sources.FeatureLayerSource\")],b);var g=b;export default g;\n"],"sourceRoot":""}